// JavaScript Document
/*pub-2|2011-11-03 09:48:40*/KISSY.add("ui/simplestar",function(a){function p(c){var d=this;d.elCtl=a.one(b.create('<div class="ks-ss-tooltip">tooltip</div>')),a.ready(function(){d.elCtl.appendTo(document.body)}),this.to=null}var b=a.DOM,c=a.namespace("ui"),d=imageServer+"/images/evaluate/pj2.png,e=imageServer+"/images/evaluate/pj1.png",f=imageServer+"/images/evaluate/pj3.png",g="ks-ss-focus",h="change",i=a.Config.debug,j="hoverchange",k=1,l=function(){return"undefined"!=typeof console&&console.log?function(a){if(!i)return;console.log(a)}:function(a){if(!i)return;alert(a)}}(),m={tmpl:"<dl><dt>{score}\u5206 {levelText}</dt><dd>{tooltip}</dd></dl>",tipstmpl:"<strong>{score}\u5206</strong> - {tooltip}"},n=new p,o=c.SimpleStar=function(c,d){var f=this;f.el=a.one(c),f.config=a.merge(m,d),f.inputs=f.el.all("input");var g=b.create('<span class="ks-simplestar" />'),h=b.create('<span class="ks-ss-tips" />');f.images=[],f.hoverIndex=-1,f.checked=-1,f.elCtl=a.one(g),f.elTips=a.one(h),f.el.css("position","absolute").css("left","-9999px"),f.inputs.each(function(a){var b=new Image;b.src=e,f.images.push(b),f.elCtl.append(b)}),f.elCtl.insertAfter(f.el),f.elTips.insertAfter(f.elCtl),a.later(function(){f.initEvent()},10)};return a.augment(o,a.EventTarget,{initEvent:function(){var b=this,c=b.elCtl;b.on(h,function(a){l("simplestart event change"),b.renderStar(),b.renderTips(a)}).on(j,function(c){l("simplestart event hoverchange"),b.renderStar(),c.hoverIndex!==-1?n.show(this.images[c.hoverIndex],a.substitute(b.config.tmpl,c)):n.hide()}),b.monitorRadios(),b.inputs.on("click",function(a){l("inputs event click"),b.monitorRadios()}).on("focus",function(a){l("inputs event focus"),c.addClass(g)}).on("blur",function(a){l("inputs event blur"),c.removeClass(g)}),c.on("click",function(c){var d=a.one(c.target),e=a.indexOf(d[0],b.images);l("event click elCtl idx="+e),e!==-1&&(b.inputs[e].checked=!0,b.monitorRadios(),n.hide())}).on("mouseover",function(c){var d=a.one(c.target);if(d[0].tagName.toLowerCase()=="img"){l("event mouseover elCtl img");var e=a.indexOf(d[0],b.images);b.hoverIndex=e,b.fire(j,{hoverIndex:e,score:e+1,levelText:b.getLevel(e),tooltip:b.getTooltip(e)})}}).on("mouseleave",function(){l("event mouseleave elCtl"),b.hoverIndex=-1,b.fire(j,{hoverIndex:b.hoverIndex})}),a.each(b.inputs,function(c,d){a.one(c).attr("title",b.getLevel(d)+"\uff0c"+b.getTooltip(d))})},monitorRadios:function(){var a=this,b=a.index();b!==a.checked&&(a.checked=b,a.fire(h,{score:b+1,levelText:a.getLevel(b),tooltip:a.getTooltip(b),index:b}))},index:function(){var b=this,c=-1;return b.inputs.each(function(b,d){a.one(b)[0].checked&&(c=d)}),c},renderStar:function(){var b=this,c=b.hoverIndex!==-1?b.hoverIndex:b.checked;a.each(b.images,function(a,b){var g=e;c>=0&&c<=k&&b<=c&&(g=f),c>=0&&c>k&&b<=c&&(g=d),a.src=g})},renderTips:function(b){var c=this;c.elTips.html(a.substitute(c.config.tipstmpl,b))},getTooltip:function(a){var b=this;return b.config.tooltips[a]||a},getLevel:function(a){var b=this;return b.config.levelText[a]||a}}),a.augment(p,{show:function(c,d){var e=this;e.to&&(e.to.cancel(),e.to=null),d&&e.elCtl.html(d);var f=b.width(c),g=b.height(c),h=b.offset(c);e.elCtl.css("display","block"),e.to=a.later(function(){e.to=null;var a=e.elCtl.width();e.elCtl.offset({left:h.left+f/2-a*.5,top:h.top+g+2}),e.elCtl.css("visibility","visible")},10)},hide:function(){var b=this;b.to&&(b.to.cancel(),b.to=null),b.to=a.later(function(){b.to=null,b.elCtl.css("visibility","hidden").css("display","none")},100)}}),o});